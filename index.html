<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Cloud Notes â€” Offline Notes App</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        :root {
            --accent:#1976d2;
            --bg:#f4f7fb;
            --card:#ffffff;
        }
        * { box-sizing:border-box; }
        body {
            margin:0;
            font-family:Arial, sans-serif;
            background:var(--bg);
            display:flex;
            justify-content:center;
            padding:20px;
        }
        .app {
            width:100%;
            max-width:900px;
            background:var(--card);
            padding:20px;
            border-radius:10px;
            box-shadow:0 0 15px rgba(0,0,0,0.1);
        }
        header { display:flex; align-items:center; margin-bottom:15px; }
        header h1 { margin:0; font-size:22px; }
        .top-actions { margin-left:auto; display:flex; gap:10px; }
        button {
            padding:8px 14px;
            border:0;
            border-radius:8px;
            cursor:pointer;
            background:var(--accent);
            color:#fff;
        }
        button.ghost {
            background:transparent;
            border:1px solid #bbb;
            color:var(--accent);
        }
        main {
            display:grid;
            grid-template-columns:280px 1fr;
            gap:12px;
        }
        input, textarea {
            width:100%;
            padding:10px;
            border:1px solid #ccc;
            border-radius:8px;
            margin-bottom:8px;
        }
        textarea { height:320px; resize:none; }
        .note-list { max-height:65vh; overflow:auto; }
        .note-item {
            padding:10px;
            border-radius:8px;
            margin-bottom:8px;
            cursor:pointer;
            border:1px solid transparent;
        }
        .note-item.active {
            background:#e9f2ff;
            border-color:#c9e0ff;
        }
        footer { font-size:14px; margin-top:10px; display:flex; justify-content:space-between; }
        @media(max-width:800px){
            main { grid-template-columns:1fr; }
        }
    </style>
</head>
<body>

<div class="app">
    <header>
        <h1>Cloud Notes (Offline)</h1>
        <div class="top-actions">
            <button id="newBtn">New</button>
            <button id="exportBtn" class="ghost">Export</button>
            <button id="importBtn" class="ghost">Import</button>
            <input type="file" id="fileInput" style="display:none" accept=".json">
        </div>
    </header>

    <main>
        <aside>
            <input id="search" placeholder="Search notes...">
            <div id="noteList" class="note-list"></div>
        </aside>

        <section>
            <input id="title" placeholder="Note title">
            <textarea id="content" placeholder="Write your note..."></textarea>

            <button id="saveBtn">Save</button>
            <button id="deleteBtn" class="ghost">Delete</button>

            <footer>
                <span>Saved automatically in browser</span>
                <button id="clearAll" class="ghost">Clear All</button>
            </footer>
        </section>
    </main>
</div>

<script>
const STORAGE_KEY = "cloud_notes_v1";
let notes = [];
let activeId = null;

const noteList = document.getElementById("noteList");
const titleInput = document.getElementById("title");
const contentInput = document.getElementById("content");
const searchInput = document.getElementById("search");

function uid(){
    return Date.now().toString(36) + Math.random().toString(36).slice(2,8);
}

function loadNotes(){
    const raw = localStorage.getItem(STORAGE_KEY);
    notes = raw ? JSON.parse(raw) : [];
}

function saveNotes(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
}

function renderList(filter=""){
    noteList.innerHTML = "";
    const q = filter.toLowerCase().trim();

    const list = notes
        .slice()
        .sort((a,b)=>b.updated-a.updated)
        .filter(n => !q || (n.title+" "+n.content).toLowerCase().includes(q));

    if(list.length === 0){
        noteList.innerHTML = "<div>No notes</div>";
        return;
    }

    list.forEach(n=>{
        const d = document.createElement("div");
        d.className = "note-item" + (n.id===activeId ? " active":"");
        d.innerHTML = `<strong>${n.title || "(Untitled)"}</strong><br><small>${new Date(n.updated).toLocaleString()}</small>`;
        d.onclick = ()=> openNote(n.id);
        noteList.appendChild(d);
    });
}

function openNote(id){
    activeId = id;
    const n = notes.find(x=>x.id===id);
    if(!n) return;
    titleInput.value = n.title;
    contentInput.value = n.content;
    renderList(searchInput.value);
}

function newNote(){
    const n = {id:uid(), title:"", content:"", updated:Date.now()};
    notes.push(n);
    saveNotes();
    activeId = n.id;
    renderList();
    openNote(n.id);
}

function deleteNote(){
    if(!activeId) return;
    notes = notes.filter(n=>n.id !== activeId);
    activeId = null;
    saveNotes();
    renderList();
    titleInput.value = "";
    contentInput.value = "";
}

function clearAllNotes(){
    if(!confirm("Delete all notes?")) return;
    notes = [];
    activeId = null;
    saveNotes();
    renderList();
    titleInput.value = "";
    contentInput.value = "";
}

function exportNotes(){
    const blob = new Blob([JSON.stringify(notes,null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "notes-export.json";
    a.click();
}

function importNotesFile(file){
    const reader = new FileReader();
    reader.onload = () => {
        try {
            const imported = JSON.parse(reader.result);
            if(!Array.isArray(imported)) throw new Error("Invalid file");

            let firstNewId = null;

            imported.forEach(n=>{
                const newN = {
                    id: uid(),
                    title: n.title || "",
                    content: n.content || "",
                    updated: n.updated ? Number(n.updated) : Date.now()
                };
                notes.push(newN);
                if(!firstNewId) firstNewId = newN.id;
            });

            saveNotes();
            renderList();

            if(firstNewId){
                activeId = firstNewId;
                openNote(firstNewId);
            }

            alert("Import successful!");
        } catch(e){
            alert("Import failed: " + e.message);
        }
    };
    reader.readAsText(file);
}

// AUTOSAVE
let timer = null;
function autosave(){
    if(!activeId) return;
    if(timer) clearTimeout(timer);
    timer = setTimeout(()=>{
        const n = notes.find(x=>x.id===activeId);
        n.title = titleInput.value;
        n.content = contentInput.value;
        n.updated = Date.now();
        saveNotes();
        renderList(searchInput.value);
    }, 600);
}

// Events
document.getElementById("newBtn").onclick = newNote;
document.getElementById("saveBtn").onclick = autosave;
document.getElementById("deleteBtn").onclick = deleteNote;
document.getElementById("clearAll").onclick = clearAllNotes;
document.getElementById("exportBtn").onclick = exportNotes;
document.getElementById("importBtn").onclick = ()=> document.getElementById("fileInput").click();
document.getElementById("fileInput").onchange = e => importNotesFile(e.target.files[0]);

titleInput.oninput = autosave;
contentInput.oninput = autosave;
searchInput.oninput = ()=> renderList(searchInput.value);

// Init
loadNotes();
renderList();
if(notes.length){ activeId = notes[0].id; openNote(activeId); }

// Service Worker
if("serviceWorker" in navigator){
    navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
